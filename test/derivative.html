<!DOCTYPE HTML PUBLIC>
<html>
<head>
    <title>Parser Test</title>
    <script src="../Parse.js" type="text/javascript"></script>
    <script src="../Check.js" type="text/javascript"></script>
    <script src="../Derivate.js" type="text/javascript"></script>
    <script src="../utils/DisjointSet.js" type="text/javascript"></script>
    <script src="../utils/Evaluate.js" type="text/javascript"></script>
    <script src="../utils/Compare.js" type="text/javascript"></script>
    <script src="../utils/ASTCache.js" type="text/javascript"></script>
    <script src="../Simplify.js" type="text/javascript"></script>
    <script src="../Format.js" type="text/javascript"></script>
    <script type="text/javascript">
        var MATHTEX_CGI = 'http://twbs.in:8081/cgi-bin/mathtex.cgi';
        onInputChange = function () {
            var input = document.getElementById('input'),
                    error = document.getElementById('error'),
                    resultdx = document.getElementById('dx'),
                    resultdy = document.getElementById('dy'),
                    resultdxy = document.getElementById('dxy'),
                    simp = document.getElementById('simp'),
                    ast, dx, dy, dxy;
            try {
                ast = parseExp(input.value);
                checkExp(ast);
                ast = simplify(ast);
                simp.src = MATHTEX_CGI + '?' + encodeURI(formatExp(ast, 'latex'));
                try {
                    dx = derivExp(ast, 'x');
                    dx = simplify(dx);
                    dy = derivExp(ast, 'y');
                    dy = simplify(dy);
                    dxy = simplify(derivExp(dx, 'y'));
                    var formData = new FormData();
                    var dxLatex = formatExp(dx, 'latex');
                    resultdx.src = MATHTEX_CGI + '?' +
                            encodeURI('\\frac{\\partial f}{\\partial x} = ' + formatExp(dx, 'latex') + '\\\\');
                    resultdy.src = MATHTEX_CGI + '?' +
                            encodeURI('\\frac{\\partial f}{\\partial y} = ' + formatExp(dy, 'latex') + '\\\\');
                    resultdxy.src = MATHTEX_CGI + '?' +
                            encodeURI('\\frac{\\partial^2 f}{\\partial x \\partial y} = ' + formatExp(dxy, 'latex') + '\\\\');
                    error.innerHTML = '';
                } catch (e) {
                    error.innerHTML = e;
                    simp.src = '';
                    resultdx.src = '';
                    resultdy.src = '';
                    resultdxy.src = '';
                }
            } catch (e) {
                error.innerHTML = e;
                simp.src = '';
                resultdx.src = '';
                resultdy.src = '';
                resultdxy.src = '';
            }
        }
    </script>
    <style>
        .math {
            width: 400px;
            min-height: 150px;
            margin: 7px;
            box-sizing: border-box;
            padding: 7px;
            background-position: 7px 7px;
            background-repeat: no-repeat;
            overflow-y: visible;
            overflow-x: auto;
        }

        .math-inline {
            line-height: 22px;
        }

    </style>
</head>
<body>
<div class="math-inline">
    <i>f</i> =
</div>
<textarea id="input" class="math" onkeyup="onInputChange()"></textarea>
<br/>
<span id="error" style="color:red">&nbsp;</span><br/>

Simplified:<br/>

<div class="math" style="outline: 1px solid black">
    <img id="simp"/>
</div>
<br/>
Partial derivative:<br/>

<div class="math" style="outline: 1px solid black">
    <img id="dx"/><br/>
    <img id="dy" style="margin-top: 7px"/><br/>
    <img id="dxy" style="margin-top: 7px"/>
</div>

</body>
</html>